const l="http://localhost";const w=`${l}:3000`,n={get:async e=>await chrome.runtime.sendMessage({type:"store",action:"get",key:e}),set:async(e,t)=>await chrome.runtime.sendMessage({type:"store",action:"set",key:e,value:t}),clear:async()=>await chrome.runtime.sendMessage({type:"store",action:"clear",key})},i=async()=>{try{const e=await n.get("userId"),t=window.location.host;if(!e||!t){console.warn("no userId/host found");return}const s=await n.get("times")||{[e]:{[t]:[]}};s[e][t]||(s[e][t]=[]),s[e][t].push(Date.now()),s[e][t].length>10&&r(e,t,s),await n.set("times",s)}catch(e){console.error(e)}},r=async(e,t,s)=>{try{s[e][t]||(s[e][t]=[Date.now()]);const a=await fetch(`${w}/api/times/${e}/${t}`,{method:"post",body:JSON.stringify(s[e][t])});s[e][t]=[],await n.set("times",s)}catch(a){throw a}};let o;const c=async()=>{try{if(document.visibilityState==="visible"){if(o)return;console.log("start tracking");const e=await n.get("userId"),t=window.location.host;if(!e||!t){console.warn("Please log into the PromptArmorWebtracking extension.");return}const s=await n.get("times");s&&r(e,t,s),o=setInterval(()=>{i()},1e3),i()}else{console.log("stop tracking"),clearInterval(o),o=null;const e=await n.get("times");e&&r(userId,host,e)}}catch(e){console.log(e)}};window.addEventListener("visibilitychange",()=>c());c();window.addEventListener("message",e=>{var t;e.source!==window||((t=e.data)==null?void 0:t.source)!=="dashboard_app"||window.postMessage({source:"webtracking_extension",extensionId:chrome.runtime.id})});
