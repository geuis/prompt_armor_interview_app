const l="http://localhost";const p=`${l}:3000`,n={get:async e=>await chrome.runtime.sendMessage({type:"store",action:"get",key:e}),set:async(e,t)=>await chrome.runtime.sendMessage({type:"store",action:"set",key:e,value:t}),clear:async()=>await chrome.runtime.sendMessage({type:"store",action:"clear",key})},a=async()=>{try{const e=await n.get("userId"),t=window.location.host;if(!e||!t){console.warn("no userId/host found");return}const s=await n.get("times")||{[e]:{[t]:[]}};s[e][t]||(s[e][t]=[]),s[e][t].push(Date.now()),s[e][t].length>10&&i(e,t,s),await n.set("times",s)}catch(e){console.error(e)}},i=async(e,t,s)=>{try{s[e][t]||(s[e][t]=[Date.now()]);const r=await fetch(`${p}/api/times/${e}/${t}`,{method:"post",body:JSON.stringify(s[e][t])});s[e][t]=[],await n.set("times",s)}catch(r){throw r}};let o;const c=async()=>{try{if(document.visibilityState==="visible"){if(o)return;console.log("start tracking");const e=await n.get("userId"),t=window.location.host;if(!e||!t){console.warn("Please log into the PromptArmorWebtracking extension.");return}const s=await n.get("times");s&&i(e,t,s),o=setInterval(()=>{a()},1e3),a()}else console.log("stop tracking"),clearInterval(o),o=null}catch(e){console.log(e)}};window.addEventListener("visibilitychange",()=>c());c();
